Connect-AzAccount
Get-AzContext
Get-AzSubscription

## deploy to AzSubscription
New-AzSubscriptionDeployment -Location <location> -TemplateFile <path-to-template-or-bicep>
## deploy to Resource Group
New-AzResourceGroupDeployment -ResourceGroupName <resource-group-name> -TemplateFile <path-to-template-or-bicep>



# create Resource Group
New-AzSubscriptionDeployment -Location 'West Europe' -TemplateFile .\vnetbox\rg.json
$rgname = "..
$envGuid = "..

# Create Virtual Network
New-AzResourceGroupDeployment -ResourceGroupName $rgname -envGuid $envGuid -TemplateFile .\vnetbox\virtualnetwork.json

## for each VM:
$vmname = ..
$vmIndex = ..

# Create VM
New-AzResourceGroupDeployment -ResourceGroupName $rgname -envguid $envGuid -vmname $vmname -vmindex $vmIndex -TemplateFile .\vm\vm.json

# Create Private Endpoint in existing vnet. 
# Note: Private Endpoint Network Policies must be disabled for that vnet. You can create a Private Endpoint in the portal to auto-disable the policy
New-AzResourceGroupDeployment -ResourceGroupName $rgname -envGuid $envGuid -vmIndex $vmIndex -TemplateFile .\vnetbox\privatelink.json


